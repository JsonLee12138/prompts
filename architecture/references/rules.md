# Architecture Rules - Code Writing Requirements

> **重要**: 这些规则适用于所有代码编写任务。违反这些规则可能导致代码质量低下和维护困难。

---

## 📋 强制性要求

### 1. 代码编写必须遵循设计原则

**所有代码编写任务**必须严格遵循以下 10 大设计原则：

| 原则 | 缩写 | 要求 |
|------|------|------|
| 关注点分离 | SoC | 代码必须按层/模块清晰分离 |
| 单一职责原则 | SRP | 每个组件/函数只做一件事 |
| 不重复自己 | DRY | 抽象重复逻辑，避免代码重复 |
| 保持简单 | KISS | 优先选择简单方案，避免过度设计 |
| 组合优于继承 | - | 使用组合而非深度继承 |
| 高内聚低耦合 | - | 相关功能聚合，模块间依赖最小化 |
| 显式依赖 | - | 所有依赖必须声明和注入 |
| 快速失败 | - | 输入验证，立即失败并清晰报错 |
| 不可变性 | - | 默认使用不可变数据结构 |
| 可测试性 | - | 设计时考虑测试便利性 |

### 2. 必须调用架构技能

**所有代码编写任务**必须调用 `@architecture-assistant` 技能进行：

#### ✅ 代码审查
```bash
# 编写代码后必须调用
@architecture-assistant 请审查这段代码是否符合架构原则
```

#### ✅ 设计指导
```bash
# 设计新功能前必须调用
@architecture-assistant 帮我设计一个 [功能] 系统（[语言]）
```

#### ✅ ADR 文档
```bash
# 重要技术决策必须调用
@architecture-assistant 为 [决策] 创建 ADR
```

---

## 🔧 工作流程

### 流程 1: 新功能开发

```
1. 需求分析
   └─> 明确功能边界和责任

2. 设计阶段 [必须调用]
   └─> @architecture-assistant 帮我设计 [功能]

3. 编码实现
   └─> 遵循 10 大原则
   └─> 参考语言示例

4. 代码审查 [必须调用]
   └─> @architecture-assistant 请审查这段代码

5. 文档化
   └─> 如有重要决策，创建 ADR [必须调用]
   └─> @architecture-assistant 为 [决策] 创建 ADR
```

### 流程 2: 代码重构

```
1. 识别问题
   └─> 分析违反的原则

2. 制定方案 [必须调用]
   └─> @architecture-assistant 请审查这段代码并提供改进建议

3. 实施重构
   └─> 应用推荐原则
   └─> 保持向后兼容

4. 验证结果 [必须调用]
   └─> @architecture-assistant 请验证重构后的代码
```

### 流程 3: 技术决策

```
1. 识别决策点
   └─> 数据库、框架、架构模式等

2. 分析选项 [必须调用]
   └─> @architecture-assistant 帮我分析 [选项] 的优缺点

3. 做出决策
   └─> 基于原则和实际需求

4. 文档化 [必须调用]
   └─> @architecture-assistant 为 [决策] 创建 ADR
```

---

## 🎯 检查清单

### 编码前
- [ ] 已调用 `@architecture-assistant` 进行设计指导
- [ ] 理解功能边界和职责划分
- [ ] 确认没有违反 SRP 和 SoC

### 编码中
- [ ] 每个函数/类遵循单一职责
- [ ] 使用显式依赖注入
- [ ] 考虑可测试性（可 mock 的依赖）
- [ ] 避免代码重复（DRY）
- [ ] 保持简单（KISS）

### 编码后
- [ ] 已调用 `@architecture-assistant` 进行代码审查
- [ ] 修复所有严重问题
- [ ] 如有重要决策，已创建 ADR
- [ ] 代码符合语言最佳实践

### 提交前
- [ ] 通过架构技能审查
- [ ] 原则违反数 < 2
- [ ] ADR 已创建（如需要）
- [ ] 文档已更新

---

## 🚫 禁止行为

### 绝对禁止
1. **不调用技能直接编码**
   ```
   ❌ 直接写代码，不寻求架构指导
   ✅ 先调用 @architecture-assistant 进行设计
   ```

2. **违反核心原则**
   ```
   ❌ God Objects（>500 行，>10 个职责）
   ❌ 循环依赖
   ❌ 重复代码
   ❌ 隐式依赖
   ```

3. **忽略文档**
   ```
   ❌ 重要决策不创建 ADR
   ❌ 不记录架构选择理由
   ```

### 强烈不建议
1. 过度工程化（违反 KISS）
2. 深度继承层次（违反组合优于继承）
3. 紧密耦合（违反低耦合）
4. 不可测试的代码

---

## 📊 质量标准

### 优秀代码标准
- ✅ 遵循 9-10 个核心原则
- ✅ 通过 `@architecture-assistant` 审查
- ✅ 有清晰的 ADR（如需要）
- ✅ 易于测试和维护
- ✅ 语言特定最佳实践

### 合格代码标准
- ✅ 遵循 7-8 个核心原则
- ✅ 无严重反模式
- ✅ 基本可测试

### 不合格代码标准
- ❌ 违反 3+ 个核心原则
- ❌ 存在 God Object
- ❌ 严重耦合或循环依赖
- ❌ 未使用 `@architecture-assistant` 审查

---

## 🛠️ 技能使用指南

### 何时必须调用

| 场景 | 技能调用 | 命令示例 |
|------|----------|----------|
| 新功能设计 | ✅ 必须 | `@architecture-assistant 帮我设计用户认证系统` |
| 代码编写后 | ✅ 必须 | `@architecture-assistant 请审查这段代码` |
| 技术决策 | ✅ 必须 | `@architecture-assistant 为数据库选型创建 ADR` |
| 代码重构 | ✅ 必须 | `@architecture-assistant 请提供重构建议` |
| 学习原则 | 推荐 | `@architecture-assistant 解释 SRP 原则` |
| 疑问解答 | 推荐 | `@architecture-assistant 这个设计有什么问题？` |

### 技能调用模板

#### 代码审查
```
@architecture-assistant 请审查以下代码是否符合架构原则：

\`\`\`
[你的代码]
\`\`\`

请检查：
- 10 大设计原则的遵循情况
- 语言特定最佳实践
- 潜在的反模式
- 改进建议
```

#### 设计指导
```
@architecture-assistant 帮我设计一个 [功能] 系统

要求：
- 语言：[TypeScript/Go/Rust/Python/Java]
- 主要功能：[描述]
- 约束条件：[如有]

请提供：
- 架构结构
- 核心原则应用
- 代码示例
- 测试策略
```

#### ADR 创建
```
@architecture-assistant 为以下决策创建 ADR：

决策：[描述]
背景：[问题/需求]
理由：[为什么这样选择]
备选方案：[考虑过的其他选项]

请使用标准 ADR 模板。
```

---

## 📚 参考资源

### 必读文档
1. **核心原则**: `principles/README.md`
2. **语言示例**: `examples/[语言]/README.md`
3. **ADR 模板**: `templates/adr-template.md`
4. **技能文档**: `skills/SKILL.md`

### 快速访问
```
# 查看原则
cat architecture/principles/README.md

# 查看示例
cat architecture/examples/typescript/README.md

# 查看技能
cat architecture/skills/SKILL.md
```

---

## ⚖️ 违规处理

### 轻微违规（1-2 个原则）
- 在代码审查中指出
- 要求在下次提交前修复
- 记录学习点

### 严重违规（3+ 个原则或反模式）
- 阻止代码合并
- 必须重新设计
- 调用 `@architecture-assistant` 全面审查

### 重复违规
- 团队培训
- 一对一指导
- 考虑代码所有权调整

---

## 🎓 培训要求

### 新成员入职
1. 阅读本规则文档（30 分钟）
2. 学习核心原则（1 小时）
3. 完成语言示例练习（2 小时）
4. 实际项目应用（持续指导）

### 团队培训
- 每月架构分享会
- 代码审查案例分析
- ADR 评审会议
- 原则应用讨论

---

## 🔄 持续改进

### 规则更新
- 每季度审查一次
- 基于实际经验调整
- 团队投票通过

### 反馈渠道
- 提出改进建议
- 分享实际案例
- 报告规则问题

---

## ✅ 总结

**核心要求**：
1. 📌 **所有代码编写必须遵循 10 大设计原则**
2. 📌 **所有代码编写必须调用 `@architecture-assistant` 技能**
3. 📌 **重要决策必须创建 ADR**

**记住**：
> 代码质量不是可选项，而是必需品。
> 架构技能不是辅助工具，而是强制要求。

---

**版本**: 1.0
**状态**: 已批准
**最后更新**: 2026-01-13
**适用范围**: 所有代码编写任务
